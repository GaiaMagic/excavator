# don't use `fig build` or `fig up` manually, use `make`

# data-only container
data:
  image: busybox:latest
  volumes:
    - /data/db

usercontent:
  image: busybox:latest
  volumes:
    - /admincontent
    - /srv/excavator/admincontent:/admincontent
    - /usercontent
    - /srv/excavator/usercontent:/usercontent

# mongodb
# remember to also update excavator.js if you change this service name
db:
  image: mongo:2.6.5
  volumes_from:
    - data

# backend
backend:
  build: .
  links:
    - db
  ports:
    - 3000
  volumes_from:
    - usercontent

# frontend
frontend:
  build: .
  environment:
    - GIT_HEAD_COMMIT
    - GIT_HEAD_DATE
    - GIT_HEAD_AUTHOR
    - GIT_HEAD_FILE_COUNT
  volumes:
    - /srv/excavator/dist:/excavator/dist # also in Makefile
